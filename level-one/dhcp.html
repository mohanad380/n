<!DOCTYPE html>

<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>بروتوكول DHCP - عالم الشبكات</title>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&amp;display=swap" rel="stylesheet"/>
<link href="../css/style.css" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&amp;display=swap" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet"/>
</head>
<body>
<!-- القائمة الرئيسية -->
<header>
<div class="container header-container">
<a class="logo" href="../index.html">عالم الشبكات</a>
<button aria-label="Toggle navigation" class="menu-toggle">
<i class="fas fa-bars"></i>
</button>
<nav class="main-nav">
<ul>
<li><a href="../index.html">الرئيسية</a></li>
<li><a href="../basics.html">الأساسيات</a></li>
<li><a href="../level-one.html">المستوى الأول</a></li>
<li><a href="../level-two.html">المستوى الثاني</a></li>
<li><a href="../tests.html">الاختبارات</a></li>
</ul>
</nav>
<!-- New Dropdown Menu -->
<nav class="mobile-nav">
<ul>
<li><a href="../index.html">الرئيسية</a></li>
<li class="has-submenu">
<a href="#">الأساسيات <i class="fas fa-chevron-down dropdown-arrow"></i></a>
<ul class="submenu">
<li><a href="../basics/intro.html">مقدمة في الشبكات</a></li>
<li><a href="../basics/types.html">أنواع الشبكات</a></li>
<li><a href="../basics/topology.html">طوبولوجيا الشبكات</a></li>
<li><a href="../basics/protocols.html">بروتوكولات الشبكات</a></li>
<li><a href="../basics/devices.html">أجهزة الشبكات</a></li>
<li><a href="../basics/osi.html">نموذج OSI</a></li>
</ul>
</li>
<li class="has-submenu">
<a href="#">المستوى الأول <i class="fas fa-chevron-down dropdown-arrow"></i></a>
<ul class="submenu">
<li><a href="../level-one/ip-addressing.html">عنونة IP</a></li>
<li><a href="../level-one/routing.html">التوجيه</a></li>
<li><a href="../level-one/switching.html">التبديل</a></li>
<li><a href="../level-one/vlan.html">الشبكات الافتراضية VLAN</a></li>
<li><a href="../level-one/wireless.html">الشبكات اللاسلكية</a></li>
<li><a href="../level-one/security.html">أمن الشبكات</a></li>
<li><a href="../level-one/nat.html">ترجمة عناوين الشبكة NAT</a></li>
<li><a href="../level-one/dhcp.html">بروتوكول DHCP</a></li>
<li><a href="../level-one/dns.html">نظام أسماء النطاقات DNS</a></li>
<li><a href="../level-one/troubleshooting.html">استكشاف الأخطاء وإصلاحها</a></li>
<li><a href="../level-one/vpn.html">الشبكات الخاصة الافتراضية VPN</a></li>
<li><a href="../level-one/monitoring.html">مراقبة الشبكة</a></li>
</ul>
</li>
<li class="has-submenu">
<a href="#">المستوى الثاني <i class="fas fa-chevron-down dropdown-arrow"></i></a>
<ul class="submenu">
<li><a href="../level-two/mikrotik-intro.html">مقدمة في أجهزة مايكروتك</a></li>
<li><a href="../level-two/mikrotik-setup.html">إعداد أجهزة مايكروتك</a></li>
<li><a href="../level-two/mikrotik-config.html">تكوين أجهزة مايكروتك</a></li>
<li><a href="../level-two/mikrotik-routing.html">التوجيه في مايكروتك</a></li>
<li><a href="../level-two/mikrotik-wireless.html">إعدادات الشبكات اللاسلكية في مايكروتك</a></li>
<li><a href="../level-two/mikrotik-vpn.html">إعداد VPN في مايكروتك</a></li>
<li><a href="../level-two/enterprise-network-design.html">تصميم شبكات المؤسسات</a></li>
<li><a href="../level-two/cloud-networking.html">شبكات الحوسبة السحابية</a></li>
<li><a href="../level-two/advanced-network-security.html">أمن الشبكات المتقدم</a></li>
<li><a href="../level-two/iot-networking.html">شبكات إنترنت الأشياء</a></li>
</ul>
</li>
<li class="has-submenu">
<a href="#">الاختبارات <i class="fas fa-chevron-down dropdown-arrow"></i></a>
<ul class="submenu">
<li><a href="../tests/basics-test.html">اختبار الأساسيات</a></li>
<li><a href="../tests/level-one-test.html">اختبار المستوى الأول</a></li>
<li><a href="../tests/level-two-test.html">اختبار المستوى الثاني</a></li>
<li><a href="../tests/comprehensive-test.html">الاختبار الشامل</a></li>
</ul>
</li>
</ul>
</nav>
</div>
</header>
<!-- محتوى الدرس -->
<div class="container content-container">
<aside class="sidebar">
<h3 class="sidebar-title">دروس المستوى الأول</h3>
<nav class="sidebar-nav">
<ul>
<li><a href="ip-addressing.html">عنونة IP وتقسيم الشبكات</a></li>
<li><a href="routing.html">أساسيات التوجيه</a></li>
<li><a href="switching.html">أساسيات التبديل</a></li>
<li><a href="vlan.html">الشبكات المحلية الافتراضية</a></li>
<li><a href="wireless.html">الشبكات اللاسلكية</a></li>
<li><a href="security.html">أساسيات أمان الشبكات</a></li>
<li><a href="nat.html">ترجمة عناوين الشبكة</a></li>
<li><a class="active" href="dhcp.html">بروتوكول DHCP</a></li>
<li><a href="dns.html">نظام أسماء النطاقات</a></li>
<li><a href="troubleshooting.html">استكشاف الأخطاء وإصلاحها</a></li>
<li><a href="vpn.html">الشبكات الخاصة الافتراضية</a></li>
<li><a href="monitoring.html">مراقبة الشبكات وإدارتها</a></li>
</ul>
</nav>
</aside>
<main class="main-content">
<h1 class="lesson-title">بروتوكول DHCP</h1>
<div class="lesson-content">
<h2>مقدمة في بروتوكول DHCP</h2>
<p>بروتوكول تكوين المضيف الديناميكي (Dynamic Host Configuration Protocol - DHCP) هو بروتوكول شبكة يستخدم لتخصيص عناوين IP وإعدادات الشبكة الأخرى تلقائيًا للأجهزة على الشبكة. قبل ظهور DHCP، كان يجب تكوين عناوين IP وإعدادات الشبكة الأخرى يدويًا على كل جهاز، وهي عملية مستهلكة للوقت وعرضة للأخطاء، خاصة في الشبكات الكبيرة.</p>
<p>تم تطوير DHCP في أوائل التسعينيات كبديل أكثر مرونة وكفاءة للبروتوكول السابق، بروتوكول BOOTP (بروتوكول التمهيد). اليوم، يستخدم DHCP في معظم الشبكات، من الشبكات المنزلية الصغيرة إلى شبكات المؤسسات الكبيرة، لتبسيط إدارة الشبكة وتقليل الأخطاء.</p>
<img alt="مفهوم بروتوكول DHCP" src="images/placeholder.svg"/>
<h2>كيف يعمل بروتوكول DHCP؟</h2>
<p>يعمل DHCP وفق نموذج العميل/الخادم، حيث يقوم خادم DHCP بتخصيص عناوين IP وإعدادات الشبكة الأخرى للعملاء (الأجهزة) على الشبكة. عندما يتصل جهاز بالشبكة، يتبع عملية من أربع خطوات، تعرف باسم "DORA"، للحصول على عنوان IP:</p>
<h3>1. اكتشاف (Discovery)</h3>
<p>عندما يتصل جهاز (عميل DHCP) بالشبكة، فإنه لا يملك عنوان IP بعد. لذلك، يقوم بإرسال رسالة "DHCP Discover" كرسالة بث (broadcast) على الشبكة (إلى العنوان 255.255.255.255) للبحث عن خادم DHCP. تحتوي هذه الرسالة على عنوان MAC الخاص بالجهاز، والذي يستخدم لتحديد الجهاز بشكل فريد.</p>
<h3>2. عرض (Offer)</h3>
<p>عندما يتلقى خادم DHCP رسالة "DHCP Discover"، يقوم بالرد برسالة "DHCP Offer". تحتوي هذه الرسالة على عنوان IP مقترح للجهاز، بالإضافة إلى إعدادات الشبكة الأخرى مثل قناع الشبكة الفرعية (subnet mask)، والبوابة الافتراضية (default gateway)، وخوادم DNS. يمكن أن يتلقى الجهاز عدة عروض من خوادم DHCP مختلفة إذا كان هناك أكثر من خادم DHCP على الشبكة.</p>
<h3>3. طلب (Request)</h3>
<p>بعد تلقي رسالة "DHCP Offer"، يقوم الجهاز بإرسال رسالة "DHCP Request" كرسالة بث على الشبكة. تحدد هذه الرسالة خادم DHCP الذي يرغب الجهاز في قبول عرضه وتطلب رسميًا عنوان IP المقترح. يتم إرسال هذه الرسالة كبث حتى تعرف جميع خوادم DHCP الأخرى أن عرضها لم يتم قبوله.</p>
<h3>4. إقرار (Acknowledgment)</h3>
<p>يقوم خادم DHCP المحدد بالرد على رسالة "DHCP Request" برسالة "DHCP Acknowledgment" (DHCP ACK). تؤكد هذه الرسالة تخصيص عنوان IP وتوفر الإعدادات النهائية للجهاز. تتضمن الرسالة أيضًا معلومات حول مدة الإيجار (lease time)، وهي المدة التي يمكن للجهاز استخدام عنوان IP المخصص قبل الحاجة إلى تجديده.</p>
<p>بمجرد اكتمال هذه العملية، يمكن للجهاز استخدام عنوان IP المخصص وإعدادات الشبكة الأخرى للاتصال بالشبكة.</p>
<h2>مدة الإيجار وتجديد DHCP</h2>
<p>عندما يخصص خادم DHCP عنوان IP لجهاز، فإنه يخصصه لفترة محددة تسمى "مدة الإيجار" (lease time). مدة الإيجار هي الوقت الذي يمكن للجهاز استخدام عنوان IP المخصص قبل الحاجة إلى تجديده. تختلف مدة الإيجار الافتراضية اعتمادًا على تكوين خادم DHCP، ولكنها عادة ما تكون 24 ساعة في الشبكات المنزلية وقد تكون أطول أو أقصر في بيئات أخرى.</p>
<p>قبل انتهاء مدة الإيجار، يحاول الجهاز تجديد إيجار عنوان IP الخاص به. تحدث عملية التجديد عادة عندما يصل الإيجار إلى 50% من مدته (T1) ثم مرة أخرى عند 87.5% من مدته (T2).</p>
<h3>تجديد عند T1 (50% من مدة الإيجار)</h3>
<p>عند نقطة T1، يرسل الجهاز رسالة "DHCP Request" مباشرة إلى خادم DHCP الذي خصص له عنوان IP في الأصل. إذا كان الخادم متاحًا، فسيرد برسالة "DHCP ACK" لتأكيد التجديد وتحديد مدة إيجار جديدة.</p>
<h3>إعادة الربط عند T2 (87.5% من مدة الإيجار)</h3>
<p>إذا لم يتلق الجهاز ردًا على طلب التجديد عند T1، فسينتظر حتى نقطة T2. عند T2، يرسل الجهاز رسالة "DHCP Request" كرسالة بث على الشبكة، على أمل أن يستجيب أي خادم DHCP متاح. إذا استجاب خادم DHCP، فسيتم تخصيص عنوان IP جديد (قد يكون نفس العنوان السابق أو عنوانًا مختلفًا) ومدة إيجار جديدة.</p>
<h3>إعادة البدء بعد انتهاء مدة الإيجار</h3>
<p>إذا لم يتمكن الجهاز من تجديد إيجاره قبل انتهاء مدة الإيجار، فسيتوقف عن استخدام عنوان IP المخصص ويبدأ عملية DORA من جديد للحصول على عنوان IP جديد.</p>
<h2>أنواع رسائل DHCP</h2>
<p>يستخدم بروتوكول DHCP عدة أنواع من الرسائل للتواصل بين العملاء والخوادم. فيما يلي الأنواع الرئيسية لرسائل DHCP:</p>
<h3>1. DHCP Discover</h3>
<p>يرسلها العميل للبحث عن خوادم DHCP متاحة. هذه رسالة بث تصل إلى جميع الأجهزة على الشبكة المحلية.</p>
<h3>2. DHCP Offer</h3>
<p>يرسلها خادم DHCP ردًا على رسالة DHCP Discover. تحتوي على عنوان IP مقترح وإعدادات شبكة أخرى.</p>
<h3>3. DHCP Request</h3>
<p>يرسلها العميل لطلب عنوان IP المقترح في رسالة DHCP Offer أو لتجديد إيجار عنوان IP حالي.</p>
<h3>4. DHCP Acknowledgment (ACK)</h3>
<p>يرسلها خادم DHCP لتأكيد تخصيص عنوان IP وتوفير الإعدادات النهائية.</p>
<h3>5. DHCP Negative Acknowledgment (NAK)</h3>
<p>يرسلها خادم DHCP لرفض طلب DHCP Request. قد يحدث هذا إذا كان العنوان المطلوب غير متاح أو إذا كان العميل يحاول استخدام عنوان IP على شبكة خاطئة.</p>
<h3>6. DHCP Release</h3>
<p>يرسلها العميل لإخبار خادم DHCP أنه لم يعد بحاجة إلى عنوان IP المخصص. هذا يسمح لخادم DHCP بإعادة تخصيص العنوان لجهاز آخر.</p>
<h3>7. DHCP Inform</h3>
<p>يرسلها العميل الذي لديه بالفعل عنوان IP (ربما تم تكوينه يدويًا) ولكنه يحتاج إلى إعدادات شبكة إضافية من خادم DHCP.</p>
<h3>8. DHCP Decline</h3>
<p>يرسلها العميل لإخبار خادم DHCP أنه لا يمكنه استخدام عنوان IP المقترح. قد يحدث هذا إذا اكتشف العميل أن العنوان قيد الاستخدام بالفعل من قبل جهاز آخر.</p>
<h2>خيارات DHCP</h2>
<p>بالإضافة إلى تخصيص عناوين IP، يمكن لخادم DHCP توفير مجموعة متنوعة من إعدادات الشبكة الأخرى للعملاء. تسمى هذه الإعدادات "خيارات DHCP". فيما يلي بعض خيارات DHCP الشائعة:</p>
<h3>1. قناع الشبكة الفرعية (Subnet Mask)</h3>
<p>يحدد أي جزء من عنوان IP يمثل شبكة وأي جزء يمثل المضيف. هذا ضروري للأجهزة لتحديد ما إذا كان جهاز آخر على نفس الشبكة المحلية أو على شبكة مختلفة.</p>
<h3>2. البوابة الافتراضية (Default Gateway)</h3>
<p>عنوان IP للموجه الذي يجب على الجهاز إرسال حركة المرور إليه عندما يحتاج إلى الاتصال بجهاز على شبكة مختلفة.</p>
<h3>3. خوادم DNS</h3>
<p>عناوين IP لخوادم نظام أسماء النطاقات (DNS) التي يمكن للجهاز استخدامها لترجمة أسماء النطاقات (مثل www.example.com) إلى عناوين IP.</p>
<h3>4. خوادم WINS</h3>
<p>عناوين IP لخوادم خدمة اسم الإنترنت لنظام Windows (WINS)، والتي تستخدم لترجمة أسماء NetBIOS إلى عناوين IP في بيئات Windows.</p>
<h3>5. اسم النطاق</h3>
<p>اسم النطاق الذي ينتمي إليه الجهاز، مثل "example.com".</p>
<h3>6. خوادم NTP</h3>
<p>عناوين IP لخوادم بروتوكول وقت الشبكة (NTP)، والتي يمكن للجهاز استخدامها لمزامنة ساعته.</p>
<h3>7. خوادم TFTP</h3>
<p>عناوين IP لخوادم بروتوكول نقل الملفات البسيط (TFTP)، والتي يمكن استخدامها لتنزيل ملفات التكوين أو البرامج الثابتة.</p>
<h3>8. مدة الإيجار</h3>
<p>المدة التي يمكن للجهاز استخدام عنوان IP المخصص قبل الحاجة إلى تجديده.</p>
<h2>تنفيذات DHCP</h2>
<p>يمكن تنفيذ خدمة DHCP على مجموعة متنوعة من الأنظمة والأجهزة. فيما يلي بعض التنفيذات الشائعة لخوادم DHCP:</p>
<h3>1. خادم DHCP على Windows Server</h3>
<p>يوفر Windows Server خدمة DHCP كدور خادم يمكن تثبيته وتكوينه. يوفر واجهة رسومية لإدارة نطاقات DHCP، وتخصيصات العناوين، والخيارات، وغيرها من الإعدادات.</p>
<h3>2. خادم DHCP على Linux</h3>
<p>هناك عدة تنفيذات لخوادم DHCP على Linux، مع كون ISC DHCP Server هو الأكثر شيوعًا. يتم تكوينه عادة عن طريق تحرير ملف التكوين (عادة /etc/dhcp/dhcpd.conf) ويوفر مجموعة واسعة من الميزات.</p>
<h3>3. خادم DHCP على أجهزة الشبكة</h3>
<p>توفر العديد من أجهزة الشبكة، مثل الموجهات وجدران الحماية، خدمة DHCP مدمجة. هذه التنفيذات عادة ما تكون أبسط من تنفيذات الخادم الكامل ولكنها كافية للشبكات الصغيرة.</p>
<h3>4. خادم DHCP على أنظمة التشغيل الأخرى</h3>
<p>توفر أنظمة التشغيل الأخرى، مثل macOS Server وFreeBSD، أيضًا خدمات DHCP يمكن تكوينها وإدارتها.</p>
<h2>تكوين خادم DHCP</h2>
<p>يختلف تكوين خادم DHCP اعتمادًا على النظام أو الجهاز المستخدم. فيما يلي أمثلة على كيفية تكوين خادم DHCP على أنظمة مختلفة:</p>
<h3>تكوين خادم DHCP على Windows Server</h3>
<p>لتكوين خادم DHCP على Windows Server، اتبع الخطوات التالية:</p>
<ol>
<li>افتح "Server Manager" (مدير الخادم).</li>
<li>انقر على "Add roles and features" (إضافة أدوار وميزات).</li>
<li>اتبع المعالج وحدد "DHCP Server" (خادم DHCP) كدور لتثبيته.</li>
<li>بعد التثبيت، افتح "DHCP Manager" (مدير DHCP).</li>
<li>انقر بزر الماوس الأيمن على اسم الخادم واختر "New Scope" (نطاق جديد).</li>
<li>اتبع معالج "New Scope" لتحديد:
                        <ul>
<li>اسم ووصف النطاق.</li>
<li>نطاق عناوين IP (البداية والنهاية).</li>
<li>أي استثناءات (عناوين IP لا ينبغي تخصيصها).</li>
<li>مدة الإيجار.</li>
<li>خيارات DHCP مثل البوابة الافتراضية وخوادم DNS.</li>
<li>ما إذا كان يجب تنشيط النطاق الآن.</li>
</ul>
</li>
<li>بعد إنشاء النطاق، يمكنك تكوين خيارات إضافية أو إنشاء حجوزات لأجهزة معينة.</li>
</ol>
<h3>تكوين خادم DHCP على Linux (ISC DHCP Server)</h3>
<p>لتكوين خادم ISC DHCP على Linux، اتبع الخطوات التالية:</p>
<ol>
<li>قم بتثبيت حزمة خادم DHCP:
                        <pre>sudo apt-get install isc-dhcp-server   # على Ubuntu/Debian
sudo yum install dhcp                  # على CentOS/RHEL</pre>
</li>
<li>قم بتحرير ملف التكوين الرئيسي (/etc/dhcp/dhcpd.conf):
                        <pre>sudo nano /etc/dhcp/dhcpd.conf</pre>
</li>
<li>أضف تكوينًا أساسيًا مثل:
                        <pre>
# إعدادات عامة
default-lease-time 600;
max-lease-time 7200;
option subnet-mask 255.255.255.0;
option broadcast-address 192.168.1.255;
option routers 192.168.1.1;
option domain-name-servers 8.8.8.8, 8.8.4.4;
option domain-name "example.com";

# تعريف الشبكة الفرعية
subnet 192.168.1.0 netmask 255.255.255.0 {
  range 192.168.1.100 192.168.1.200;
}

# حجز عنوان ثابت لجهاز معين
host printer {
  hardware ethernet 00:11:22:33:44:55;
  fixed-address 192.168.1.250;
}
                        </pre>
</li>
<li>حدد الواجهة التي سيستمع عليها خادم DHCP بتحرير ملف الواجهة:
                        <pre>sudo nano /etc/default/isc-dhcp-server</pre>
                        وتعيين INTERFACES="eth0" (استبدل eth0 بالواجهة المناسبة).
                    </li>
<li>أعد تشغيل خدمة DHCP:
                        <pre>sudo systemctl restart isc-dhcp-server</pre>
</li>
</ol>
<h3>تكوين خادم DHCP على موجه منزلي</h3>
<p>لتكوين خادم DHCP على موجه منزلي، اتبع الخطوات التالية:</p>
<ol>
<li>قم بالوصول إلى واجهة إدارة الموجه عن طريق إدخال عنوان IP الخاص بالموجه (عادة 192.168.1.1 أو 192.168.0.1) في متصفح الويب.</li>
<li>قم بتسجيل الدخول باستخدام اسم المستخدم وكلمة المرور الخاصين بالموجه.</li>
<li>ابحث عن قسم "DHCP" أو "LAN" في واجهة الإدارة.</li>
<li>قم بتمكين خادم DHCP إذا لم يكن ممكنًا بالفعل.</li>
<li>قم بتكوين نطاق عناوين IP (البداية والنهاية) التي سيخصصها خادم DHCP.</li>
<li>قم بتكوين مدة الإيجار.</li>
<li>قم بتكوين خيارات DHCP الأخرى مثل البوابة الافتراضية (عادة عنوان IP للموجه) وخوادم DNS.</li>
<li>احفظ التغييرات وأعد تشغيل الموجه إذا لزم الأمر.</li>
</ol>
<h2>وكيل DHCP (DHCP Relay)</h2>
<p>في بعض الحالات، قد يكون خادم DHCP على شبكة مختلفة عن العملاء الذين يحتاجون إلى عناوين IP. نظرًا لأن رسائل DHCP Discover هي رسائل بث ولا تعبر الموجهات عادة، فإن العملاء لن يتمكنوا من الوصول إلى خادم DHCP. هنا يأتي دور وكيل DHCP (DHCP Relay).</p>
<p>وكيل DHCP هو جهاز (عادة موجه) يستمع إلى رسائل بث DHCP من العملاء ويعيد توجيهها كرسائل موجهة (unicast) إلى خادم DHCP على شبكة مختلفة. عندما يستجيب خادم DHCP، يقوم وكيل DHCP بإعادة توجيه الاستجابة إلى العميل.</p>
<p>يسمح وكيل DHCP باستخدام خادم DHCP مركزي لعدة شبكات فرعية، مما يبسط إدارة DHCP ويقلل من عدد خوادم DHCP المطلوبة.</p>
<h3>تكوين وكيل DHCP على موجه Cisco</h3>
<p>لتكوين وكيل DHCP على موجه Cisco، استخدم الأمر التالي:</p>
<pre>
interface GigabitEthernet0/0
 ip helper-address 192.168.10.10
                </pre>
<p>حيث 192.168.10.10 هو عنوان IP لخادم DHCP. هذا يخبر الموجه بإعادة توجيه رسائل بث DHCP المستلمة على واجهة GigabitEthernet0/0 إلى خادم DHCP المحدد.</p>
<h2>DHCP Snooping</h2>
<p>DHCP Snooping هي ميزة أمان تساعد في حماية الشبكة من خوادم DHCP غير المصرح بها وهجمات استنفاد عناوين DHCP. تعمل DHCP Snooping عن طريق مراقبة حركة مرور DHCP ومنع الرسائل غير المصرح بها.</p>
<p>عندما يتم تمكين DHCP Snooping على مبدل (switch)، يقوم المبدل بتصنيف المنافذ إما كمنافذ "موثوقة" أو "غير موثوقة". المنافذ الموثوقة هي تلك المتصلة بخوادم DHCP مصرح بها أو بمبدلات أخرى. المنافذ غير الموثوقة هي تلك المتصلة بالأجهزة النهائية (مثل أجهزة الكمبيوتر).</p>
<p>يسمح المبدل برسائل DHCP Server (مثل DHCP Offer و DHCP ACK) فقط من المنافذ الموثوقة. إذا تم استلام رسالة DHCP Server على منفذ غير موثوق، فسيتم رفضها. هذا يمنع الأجهزة غير المصرح بها من التظاهر بأنها خوادم DHCP.</p>
<p>بالإضافة إلى ذلك، يقوم DHCP Snooping ببناء قاعدة بيانات تربط بين عناوين MAC وعناوين IP المخصصة وغيرها من المعلومات. يمكن استخدام هذه المعلومات من قبل ميزات أمان أخرى مثل Dynamic ARP Inspection (DAI) و IP Source Guard.</p>
<h3>تكوين DHCP Snooping على مبدل Cisco</h3>
<p>لتكوين DHCP Snooping على مبدل Cisco، استخدم الأوامر التالية:</p>
<pre>
# تمكين DHCP Snooping عالميًا
switch(config)# ip dhcp snooping

# تمكين DHCP Snooping على VLAN محددة
switch(config)# ip dhcp snooping vlan 10,20

# تكوين منفذ كمنفذ موثوق
switch(config)# interface GigabitEthernet0/1
switch(config-if)# ip dhcp snooping trust

# تكوين حد معدل لرسائل DHCP على منفذ غير موثوق
switch(config)# interface GigabitEthernet0/2
switch(config-if)# ip dhcp snooping limit rate 10
                </pre>
<h2>DHCP Failover</h2>
<p>في البيئات التي تتطلب توافرًا عاليًا، من المهم ضمان استمرار خدمة DHCP حتى في حالة فشل خادم DHCP. يمكن تحقيق ذلك باستخدام DHCP Failover، وهو ترتيب يسمح لخادمي DHCP بمشاركة معلومات حول تخصيصات العناوين والعمل معًا لتوفير خدمة مستمرة.</p>
<p>هناك عدة طرق لتنفيذ DHCP Failover، اعتمادًا على النظام المستخدم:</p>
<h3>DHCP Failover في Windows Server</h3>
<p>في Windows Server 2012 وما بعده، يمكن تكوين DHCP Failover بين خادمي DHCP. يمكن تكوين الخوادم في وضع "Hot Standby" (حيث يكون خادم واحد نشطًا والآخر في وضع الاستعداد) أو في وضع "Load Balancing" (حيث يشارك كلا الخادمين في تخصيص العناوين).</p>
<p>لتكوين DHCP Failover في Windows Server:</p>
<ol>
<li>افتح "DHCP Manager" على الخادم الأساسي.</li>
<li>انقر بزر الماوس الأيمن على النطاق الذي ترغب في تكوين Failover له واختر "Configure Failover".</li>
<li>حدد خادم DHCP الشريك.</li>
<li>اختر وضع Failover (Hot Standby أو Load Balancing).</li>
<li>قم بتكوين الإعدادات الأخرى مثل "Maximum Client Lead Time" و "State Switchover Interval".</li>
<li>انقر على "Finish" لإنشاء علاقة Failover.</li>
</ol>
<h3>DHCP Failover في ISC DHCP Server</h3>
<p>في ISC DHCP Server 4.0 وما بعده، يمكن تكوين DHCP Failover بين خادمي DHCP. يتطلب ذلك تكوين كلا الخادمين للتواصل مع بعضهما البعض ومشاركة معلومات حول تخصيصات العناوين.</p>
<p>لتكوين DHCP Failover في ISC DHCP Server، أضف تكوينًا مثل:</p>
<pre>
failover peer "dhcp-failover" {
  primary;                  # استخدم "secondary" على الخادم الثانوي
  address 192.168.1.10;     # عنوان IP للخادم الحالي
  port 647;                 # منفذ للاتصال
  peer address 192.168.1.11; # عنوان IP للخادم الشريك
  peer port 647;            # منفذ للاتصال على الخادم الشريك
  max-response-delay 30;    # الوقت بالثواني قبل اعتبار الشريك غير متاح
  max-unacked-updates 10;   # عدد التحديثات غير المؤكدة قبل اعتبار الشريك غير متاح
  load balance max seconds 3; # توازن الحمل
  mclt 1800;                # الحد الأقصى لوقت إيجار العميل
  split 128;                # تقسيم نطاق العناوين (0-255)
}

subnet 192.168.1.0 netmask 255.255.255.0 {
  option routers 192.168.1.1;
  option domain-name-servers 8.8.8.8, 8.8.4.4;
  pool {
    failover peer "dhcp-failover";
    range 192.168.1.100 192.168.1.200;
  }
}
                </pre>
<h2>DHCP في IPv6</h2>
<p>في IPv6، هناك عدة طرق لتخصيص عناوين IP وإعدادات الشبكة الأخرى:</p>
<h3>1. التكوين التلقائي للعنوان بدون حالة (SLAAC)</h3>
<p>التكوين التلقائي للعنوان بدون حالة (Stateless Address Autoconfiguration - SLAAC) هو آلية في IPv6 تسمح للأجهزة بإنشاء عناوين IPv6 الخاصة بها بناءً على بادئة الشبكة المعلنة من قبل الموجه وعنوان MAC الخاص بالجهاز. لا يتطلب SLAAC خادم DHCP ولا يحتفظ بحالة تخصيصات العناوين.</p>
<h3>2. DHCPv6 بدون حالة (Stateless DHCPv6)</h3>
<p>في DHCPv6 بدون حالة، تحصل الأجهزة على عناوين IPv6 الخاصة بها باستخدام SLAAC، ولكنها تستخدم DHCPv6 للحصول على معلومات إضافية مثل خوادم DNS واسم النطاق. لا يحتفظ خادم DHCPv6 بحالة تخصيصات العناوين، ولكنه يوفر فقط معلومات إضافية.</p>
<h3>3. DHCPv6 مع حالة (Stateful DHCPv6)</h3>
<p>في DHCPv6 مع حالة، يعمل خادم DHCPv6 بشكل مشابه لخادم DHCP في IPv4. يخصص عناوين IPv6 للأجهزة ويحتفظ بحالة هذه التخصيصات. يوفر أيضًا معلومات إضافية مثل خوادم DNS واسم النطاق.</p>
<p>يتم التحكم في الطريقة التي تستخدمها الأجهزة للحصول على عناوين IPv6 وإعدادات الشبكة الأخرى من خلال أعلام في رسائل إعلان الموجه (Router Advertisement - RA):</p>
<ul>
<li>إذا كان علم "M" (Managed) مضبوطًا، فيجب على الأجهزة استخدام DHCPv6 مع حالة للحصول على عناوين IPv6.</li>
<li>إذا كان علم "O" (Other) مضبوطًا، فيجب على الأجهزة استخدام DHCPv6 بدون حالة للحصول على معلومات إضافية.</li>
<li>إذا لم يكن أي من العلمين مضبوطًا، فيجب على الأجهزة استخدام SLAAC فقط.</li>
</ul>
<h2>استكشاف أخطاء DHCP وإصلاحها</h2>
<p>قد تواجه مشاكل مع DHCP في بعض الأحيان. فيما يلي بعض المشاكل الشائعة وكيفية استكشافها وإصلاحها:</p>
<h3>1. الجهاز لا يحصل على عنوان IP</h3>
<p>إذا لم يتمكن جهاز من الحصول على عنوان IP من خادم DHCP، فقد تكون هناك عدة أسباب محتملة:</p>
<h4>الحلول المحتملة:</h4>
<ul>
<li>تأكد من أن خادم DHCP يعمل ويمكن الوصول إليه من الشبكة.</li>
<li>تحقق من أن نطاق DHCP لم ينفد من عناوين IP المتاحة.</li>
<li>تأكد من عدم وجود تعارض في عناوين IP (قد يكون هناك جهاز آخر يستخدم العنوان المخصص).</li>
<li>تحقق من أن الجهاز متصل بالشبكة بشكل صحيح.</li>
<li>تحقق من أن الجهاز مكون لاستخدام DHCP (وليس عنوان IP ثابت).</li>
<li>تحقق من أن وكيل DHCP (إذا كان مستخدمًا) مكون بشكل صحيح.</li>
<li>تحقق من أن DHCP Snooping (إذا كان ممكنًا) لا يمنع رسائل DHCP.</li>
</ul>
<h3>2. تعارض عناوين IP</h3>
<p>قد يحدث تعارض في عناوين IP إذا كان هناك جهازان يستخدمان نفس عنوان IP على الشبكة. قد يحدث هذا إذا كان أحد الأجهزة يستخدم عنوان IP ثابت ضمن نطاق DHCP، أو إذا كان خادم DHCP يخصص عنوانًا قيد الاستخدام بالفعل.</p>
<h4>الحلول المحتملة:</h4>
<ul>
<li>تأكد من أن نطاق DHCP لا يتداخل مع عناوين IP الثابتة المستخدمة على الشبكة.</li>
<li>استخدم حجوزات DHCP للأجهزة التي تحتاج إلى عناوين IP ثابتة.</li>
<li>قم بتمكين فحص التعارض في خادم DHCP (إذا كان متاحًا).</li>
<li>استخدم أدوات مثل "arp" أو "ping" للتحقق من وجود تعارضات في عناوين IP.</li>
</ul>
<h3>3. تجديد إيجار DHCP يفشل</h3>
<p>إذا فشل جهاز في تجديد إيجار DHCP الخاص به، فقد يفقد اتصاله بالشبكة عند انتهاء مدة الإيجار.</p>
<h4>الحلول المحتملة:</h4>
<ul>
<li>تأكد من أن خادم DHCP يعمل ويمكن الوصول إليه من الشبكة.</li>
<li>تحقق من أن الجهاز متصل بالشبكة بشكل صحيح.</li>
<li>تحقق من سجلات خادم DHCP للتعرف على أي أخطاء متعلقة بتجديد الإيجار.</li>
<li>حاول تحرير إيجار DHCP وتجديده يدويًا على الجهاز (على Windows، استخدم أوامر "ipconfig /release" و "ipconfig /renew").</li>
</ul>
<h3>أدوات استكشاف أخطاء DHCP وإصلاحها</h3>
<p>هناك عدة أدوات يمكن استخدامها لاستكشاف مشاكل DHCP وإصلاحها:</p>
<ul>
<li><strong>ipconfig/ifconfig:</strong> تعرض معلومات عن تكوين الشبكة على الجهاز، بما في ذلك عنوان IP وقناع الشبكة الفرعية والبوابة الافتراضية.</li>
<li><strong>ipconfig /release و ipconfig /renew:</strong> تحرر إيجار DHCP وتطلب إيجارًا جديدًا على أنظمة Windows.</li>
<li><strong>dhclient -r و dhclient:</strong> تحرر إيجار DHCP وتطلب إيجارًا جديدًا على أنظمة Linux.</li>
<li><strong>Wireshark:</strong> يمكن استخدامه لالتقاط وتحليل رسائل DHCP، مما يساعد في تحديد أين تفشل عملية DHCP.</li>
<li><strong>سجلات خادم DHCP:</strong> توفر معلومات حول تخصيصات DHCP والأخطاء.</li>
</ul>
<h2>أفضل ممارسات DHCP</h2>
<p>لتحقيق أقصى استفادة من DHCP وتجنب المشاكل الشائعة، إليك بعض أفضل الممارسات:</p>
<h3>1. استخدم حجوزات DHCP للأجهزة التي تحتاج إلى عناوين ثابتة</h3>
<p>بدلاً من تكوين عناوين IP ثابتة يدويًا على الأجهزة، استخدم حجوزات DHCP. هذا يضمن أن الأجهزة تحصل دائمًا على نفس عنوان IP، ولكنها لا تزال تستفيد من إعدادات الشبكة الأخرى التي يوفرها DHCP.</p>
<h3>2. استخدم مدد إيجار مناسبة</h3>
<p>اختر مدد إيجار مناسبة لبيئتك. في البيئات المستقرة حيث لا تتغير الأجهزة كثيرًا، يمكن استخدام مدد إيجار أطول (مثل أيام أو أسابيع). في البيئات الديناميكية حيث تتغير الأجهزة بشكل متكرر، قد تكون مدد الإيجار الأقصر (مثل ساعات) أكثر ملاءمة.</p>
<h3>3. استخدم نطاقات DHCP لا تتداخل مع عناوين IP الثابتة</h3>
<p>تأكد من أن نطاق DHCP لا يتداخل مع أي عناوين IP ثابتة مستخدمة على الشبكة. هذا يمنع تعارضات عناوين IP.</p>
<h3>4. وثق تكوين DHCP</h3>
<p>حافظ على توثيق دقيق لتكوين DHCP الخاص بك، بما في ذلك نطاقات العناوين، والحجوزات، والخيارات. هذا سيساعد في استكشاف الأخطاء وإصلاحها وسيكون مفيدًا عند إجراء تغييرات في المستقبل.</p>
<h3>5. استخدم DHCP Failover في البيئات الحرجة</h3>
<p>في البيئات التي تتطلب توافرًا عاليًا، استخدم DHCP Failover لضمان استمرار خدمة DHCP حتى في حالة فشل خادم DHCP.</p>
<h3>6. استخدم DHCP Snooping لتحسين الأمان</h3>
<p>قم بتمكين DHCP Snooping على المبدلات لمنع هجمات خوادم DHCP غير المصرح بها وهجمات استنفاد عناوين DHCP.</p>
<h3>7. راقب استخدام DHCP</h3>
<p>راقب استخدام DHCP، بما في ذلك نسبة استخدام نطاق العناوين وأي أخطاء في سجلات DHCP. هذا يمكن أن يساعد في تحديد المشاكل المحتملة قبل أن تؤثر على المستخدمين.</p>
<h2>خلاصة</h2>
<p>بروتوكول تكوين المضيف الديناميكي (DHCP) هو بروتوكول أساسي في شبكات الحاسوب الحديثة، يوفر طريقة آلية وموثوقة لتخصيص عناوين IP وإعدادات الشبكة الأخرى للأجهزة. من خلال فهم كيفية عمل DHCP، وأنواع رسائله، وخياراته، وكيفية تكوينه واستكشاف أخطائه وإصلاحها، يمكنك استخدام هذا البروتوكول بفعالية لتبسيط إدارة الشبكة وتحسين موثوقيتها.</p>
<p>سواء كنت تدير شبكة منزلية صغيرة أو شبكة مؤسسة كبيرة، فإن DHCP يوفر فوائد كبيرة من حيث الكفاءة والموثوقية والقابلية للإدارة. باتباع أفضل الممارسات واستخدام الميزات المتقدمة مثل DHCP Failover و DHCP Snooping، يمكنك تحقيق أقصى استفادة من هذا البروتوكول الأساسي.</p>
<p>في الدرس القادم، سنتعمق في نظام أسماء النطاقات (DNS)، وهو نظام آخر أساسي في شبكات الحاسوب الحديثة، يستخدم لترجمة أسماء النطاقات (مثل www.example.com) إلى عناوين IP.</p>
</div>
<div class="lesson-navigation">
<a class="prev-lesson" href="nat.html">الدرس السابق: ترجمة عناوين الشبكة</a>
<a class="next-lesson" href="dns.html">الدرس التالي: نظام أسماء النطاقات</a>
</div>
</main>
</div>
<!-- الفوتر -->
<footer>
<div class="container footer-content">
<div class="footer-section">
<h3>عالم الشبكات</h3>
<p>الموقع التعليمي الأول المتخصص في تعليم أساسيات الشبكات وتقنياتها المتقدمة بأسلوب علمي سهل ومدعوم بالصور والرسومات التوضيحية.</p>
</div>
<div class="footer-section">
<h3>روابط سريعة</h3>
<ul>
<li><a href="../index.html">الرئيسية</a></li>
<li><a href="../basics.html">الأساسيات</a></li>
<li><a href="../level-one.html">المستوى الأول</a></li>
<li><a href="../level-two.html">المستوى الثاني</a></li>
<li><a href="../tests.html">الاختبارات</a></li>
</ul>
</div>
<div class="footer-section">
<h3>تواصل معنا</h3>
<ul>
<li><i class="fas fa-envelope"></i> البريد الإلكتروني: mohannadm380w108@gmail.com</li>
<li><i class="fas fa-phone"></i> الهاتف: 772505594</li>
<li><i class="fas fa-user"></i> مهند مهدي</li>
</ul>
<div class="social-icons">
<a href="https://www.facebook.com/profile.php?id=100026471569171" target="_blank"><i class="fab fa-facebook-f"></i></a>
<a href="https://wa.me/772505594" target="_blank"><i class="fab fa-whatsapp"></i></a>
</div>
</div>
</div>
<div class="container copyright">
<p>جميع الحقوق محفوظة © 2025 - عالم الشبكات</p>
</div>
</footer>
<script src="../js/main.js"></script>
<script src="../js/script.js"></script>
</body>
</html>
